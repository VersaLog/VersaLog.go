name: Discord Pull Request and Issue Notification

on:
  pull_request:
    types: [opened, closed, reopened, assigned, review_requested]
  issues:
    types: [opened, closed, reopened, assigned, labeled, unlabeled]

jobs:
  send_notification:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        run: |
          EVENT="${{ github.event.action }}"
          USER="${{ github.actor }}"
          EVENT_NAME="${{ github.event_name }}"

          MESSAGE=""

          if [ "$EVENT_NAME" = "pull_request" ]; then
            PR_NUMBER="${{ github.event.pull_request.number }}"
            PR_TITLE="${{ github.event.pull_request.title }}"
            PR_URL="${{ github.event.pull_request.html_url }}"
            MERGED="${{ github.event.pull_request.merged }}"

            case "$EVENT" in
              opened)
                MESSAGE="ğŸ“¢ **Pull Request #${PR_NUMBER}** ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ä½œè€…: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE\nğŸ”— URL: $PR_URL"
                ;;
              closed)
                if [ "$MERGED" = "true" ]; then
                  MESSAGE="ğŸ‰ **Pull Request #${PR_NUMBER}** ãŒãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE\nğŸ”— URL: $PR_URL"
                else
                  MESSAGE="âŒ **Pull Request #${PR_NUMBER}** ãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE\nğŸ”— URL: $PR_URL"
                fi
                ;;
              reopened)
                MESSAGE="ğŸ”„ **Pull Request #${PR_NUMBER}** ãŒå†ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE\nğŸ”— URL: $PR_URL"
                ;;
              assigned)
                MESSAGE="ğŸ™‹ **Pull Request #${PR_NUMBER}** ãŒ $USER ã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã¾ã—ãŸï¼\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE\nğŸ”— URL: $PR_URL"
                ;;
              review_requested)
                REVIEWER="${{ github.event.requested_reviewers[0].login }}"
                MESSAGE="ğŸ‘€ **Pull Request #${PR_NUMBER}** ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒ $REVIEWER ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ãƒªã‚¯ã‚¨ã‚¹ã‚¿ãƒ¼: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $PR_TITLE\nğŸ”— URL: $PR_URL"
                ;;
              *)
                MESSAGE="âš ï¸ æœªå¯¾å¿œã® Pull Request ã‚¤ãƒ™ãƒ³ãƒˆ: $EVENT"
                ;;
            esac

          elif [ "$EVENT_NAME" = "issues" ]; then
            ISSUE_NUMBER="${{ github.event.issue.number }}"
            ISSUE_TITLE="${{ github.event.issue.title }}"
            ISSUE_URL="${{ github.event.issue.html_url }}"

            case "$EVENT" in
              opened)
                MESSAGE="ğŸ› **Issue #${ISSUE_NUMBER}** ãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ä½œè€…: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nğŸ”— URL: $ISSUE_URL"
                ;;
              closed)
                MESSAGE="âœ… **Issue #${ISSUE_NUMBER}** ãŒã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nğŸ”— URL: $ISSUE_URL"
                ;;
              reopened)
                MESSAGE="ğŸ”„ **Issue #${ISSUE_NUMBER}** ãŒå†ã‚ªãƒ¼ãƒ—ãƒ³ã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nğŸ”— URL: $ISSUE_URL"
                ;;
              assigned)
                ASSIGNEE="${{ github.event.assignee.login }}"
                MESSAGE="ğŸ™‹ **Issue #${ISSUE_NUMBER}** ãŒ $ASSIGNEE ã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ æ“ä½œè€…: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nğŸ”— URL: $ISSUE_URL"
                ;;
              labeled)
                LABEL="${{ github.event.label.name }}"
                MESSAGE="ğŸ·ï¸ **Issue #${ISSUE_NUMBER}** ã«ãƒ©ãƒ™ãƒ« '${LABEL}' ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ æ“ä½œè€…: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nğŸ”— URL: $ISSUE_URL"
                ;;
              unlabeled)
                LABEL="${{ github.event.label.name }}"
                MESSAGE="ğŸ·ï¸ **Issue #${ISSUE_NUMBER}** ã‹ã‚‰ãƒ©ãƒ™ãƒ« '${LABEL}' ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸï¼\nğŸ‘¤ æ“ä½œè€…: $USER\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: $ISSUE_TITLE\nğŸ”— URL: $ISSUE_URL"
                ;;
              *)
                MESSAGE="âš ï¸ æœªå¯¾å¿œã® Issue ã‚¤ãƒ™ãƒ³ãƒˆ: $EVENT"
                ;;
            esac
          else
            MESSAGE="â“ ä¸æ˜ãªã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—: $EVENT_NAME"
          fi

          # JSONã‚’å®‰å…¨ã«ç”Ÿæˆã—ã¦é€ä¿¡ï¼ˆæ”¹è¡Œå¯¾å¿œï¼‰
          PAYLOAD=$(jq -n --arg content "$MESSAGE" '{content: $content}')

          curl -s -o /dev/null -w "%{http_code}" -X POST \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD" \
            "${{ secrets.DISCORD_WEBHOOK }}"