name: Discord Pull Request and Issue Notification

on:
  pull_request:
    types: [opened, closed, reopened, assigned, review_requested]
  issues:
    types: [opened, closed, reopened, assigned, labeled, unlabeled]

permissions:
  contents: read

jobs:
  send_notification:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          EVENT: ${{ github.event.action }}
          EVENT_NAME: ${{ github.event_name }}
          USER: ${{ github.actor }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_MERGED: ${{ github.event.pull_request.merged }}
          ISSUE_NUMBER: ${{ github.event.issue.number }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
          ASSIGNEE: ${{ github.event.assignee.login }}
          LABEL: ${{ github.event.label.name }}
        run: |
          set -e
          MESSAGE=""

          if [ "$EVENT_NAME" = "pull_request" ]; then
            case "$EVENT" in
              opened)
                MESSAGE="üì¢ Pull Request #${PR_NUMBER} created by ${USER}\n**${PR_TITLE}**\n${PR_URL}"
                ;;
              closed)
                if [ "$PR_MERGED" = "true" ]; then
                  MESSAGE="üéâ Pull Request #${PR_NUMBER} merged by ${USER}\n**${PR_TITLE}**\n${PR_URL}"
                else
                  MESSAGE="‚ùå Pull Request #${PR_NUMBER} closed by ${USER}\n**${PR_TITLE}**\n${PR_URL}"
                fi
                ;;
              reopened)
                MESSAGE="üîÑ Pull Request #${PR_NUMBER} reopened by ${USER}\n**${PR_TITLE}**\n${PR_URL}"
                ;;
              assigned)
                MESSAGE="üôã Pull Request #${PR_NUMBER} assigned to ${ASSIGNEE} by ${USER}\n**${PR_TITLE}**\n${PR_URL}"
                ;;
              review_requested)
                MESSAGE="üëÄ Review requested for PR #${PR_NUMBER} by ${USER}\n**${PR_TITLE}**\n${PR_URL}"
                ;;
              *)
                MESSAGE="‚ö† Unknown PR event: ${EVENT}"
                ;;
            esac

          elif [ "$EVENT_NAME" = "issues" ]; then
            case "$EVENT" in
              opened)
                MESSAGE="üêõ Issue #${ISSUE_NUMBER} opened by ${USER}\n**${ISSUE_TITLE}**\n${ISSUE_URL}"
                ;;
              closed)
                MESSAGE="‚úÖ Issue #${ISSUE_NUMBER} closed by ${USER}\n**${ISSUE_TITLE}**\n${ISSUE_URL}"
                ;;
              reopened)
                MESSAGE="üîÑ Issue #${ISSUE_NUMBER} reopened by ${USER}\n**${ISSUE_TITLE}**\n${ISSUE_URL}"
                ;;
              assigned)
                MESSAGE="üôã Issue #${ISSUE_NUMBER} assigned to ${ASSIGNEE} by ${USER}\n**${ISSUE_TITLE}**\n${ISSUE_URL}"
                ;;
              labeled)
                MESSAGE="üè∑Ô∏è Label '${LABEL}' added to Issue #${ISSUE_NUMBER} by ${USER}\n**${ISSUE_TITLE}**\n${ISSUE_URL}"
                ;;
              unlabeled)
                MESSAGE="üè∑Ô∏è Label '${LABEL}' removed from Issue #${ISSUE_NUMBER} by ${USER}\n**${ISSUE_TITLE}**\n${ISSUE_URL}"
                ;;
              *)
                MESSAGE="‚ö† Unknown issue event: ${EVENT}"
                ;;
            esac
          fi

          echo "Sending message to Discord..."
          echo "$MESSAGE"

          curl -X POST \
          -H "Content-Type: application/json" \
          -d "{\"username\": \"GitHub\", \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\", \"content\": \"$MESSAGE\"}" \
          "$DISCORD_WEBHOOK"